<!DOCTYPE html>
<html lang="en">
    <head>
    	<title>Mars Rover</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        
	</head>
	<body>

		<style>

			.command-panel, .data-panel {
				width: 500px;
				margin: 0 auto;
				text-align: center;
				border: 1px solid gray;
				padding: 40px;
				border-radius: 2px;
				margin-top: 30px;
			}

			span {
				letter-spacing: 2px;
			}
		</style>

		<div class="command-panel">
			<h2>Send commands</h2>
			<input type="file" name="data" id="data">
		</div>

		<div class="data-panel" id=data-panel>
		</div>
		


		<script src="mars-rover.js"></script>
		<script>

			// Create new rover object
			rover = new MarsRover();
			rover.ID = 1;


			// Element selectors
			const dataPanel = document.querySelector('#data-panel');
			const commandFile = document.querySelector('input[type="file"]');

			// Append rover's position to HTML.
			let position = document.createElement('h4');
			// position.innerHTML = `Rover ${rover.ID} is currently at position: ${rover.position}`;
			// dataPanel.appendChild(position);


			/**
			 * Send commands to the rover.
			 */
			function setCommands() {

				let file = this.files[0],
		        reader = new FileReader();
		       

		        reader.onload = function(progressEvent) {

		            // Split each line
		            let lines = this.result.split('\n');

		            // Split plateau values
			        let plateau = lines[0].split(' ');
			        this.plateau = [parseInt(plateau[0]), parseInt(plateau[1])];

		            // rover.readFile(lines);
		            // Remove the plateau value
        			lines.shift();

	
					var rover1 = new MarsRover();
					var rover2 = new MarsRover();
					var rover3 = new MarsRover();
					var rover4 = new MarsRover();
					var rover5 = new MarsRover();


					var rovers = [rover1, rover2, rover3, rover4, rover5];


					// An array with rover positions only
					let roversArray = lines.filter((element, index) => {
					  	return index % 2 === 0;
					});

					// An array with commands only
					let commandsArray = lines.filter((element, index) => {
						// Remove the risk of empty strings being returned when it reaches the end of the file
					  	return index % 2 !== 0 && index != null;
					});


					var counter = 0;

					// For each rover object in the rovers array
					for(var i = 0; i < rovers.length; i++) {
						// For each rover position in the text file
						for(var k = 0; k < roversArray.length; k++) {
							// For each rover command line in the text file
							for(var l = 0; l < commandsArray.length; l++) {
								// Adjust each rover object their values
								rovers[i].direction = roversArray[i].split(' ')[2];
								rovers[i].location = [parseInt(roversArray[i].split(' ')[0]), parseInt(roversArray[i].split(' ')[1])];
								rovers[i].position = [parseInt(roversArray[i].split(' ')[0]), parseInt(roversArray[i].split(' ')[1]), roversArray[i].split(' ')[2]];
								rovers[i].commands = commandsArray[i].toLowerCase();
							}
						}

						// Increment their ID
						counter += 1;
						rovers[i].ID = counter;

						// Navigate using each rover's commands
						rovers[i].navigate(rovers[i].commands);

						// Append a new line with each rover's final position
		            	var position = document.createElement('h4');
						position.innerHTML = `Rover ${rovers[i].ID} is currently at position: ${rovers[i].position}`;
						dataPanel.appendChild(position); 
						console.log('done');

					}

					// Make a new grid with 5 rovers
					var grid = new Grid(rovers);

					// Reset file upload field to clear value for new one
		            commandFile.value = null;

		        };

		        reader.readAsText(file);
			}


			// Listener for file upload
			commandFile.addEventListener('change', setCommands);

		</script>
	</body>
</html>